<div nz-row>
  <div class="searchInput">
    <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
      <input type="text" nz-input placeholder="用户名/手机号/邮箱/昵称等" name="searchText" [(ngModel)]="searchText"
        autocomplete="off" />
    </nz-input-group>
    <ng-template #suffixIconButton>
      <button nz-button nzType="default" nzSearch (click)="searchData()"><i nz-icon type="search"></i></button>
    </ng-template>
  </div>
</div>

<!--信息展示-->
<div nz-row class="mt-10">
  <nz-table #headerTable [nzData]="listOfData" [nzFrontPagination]="false" nzHideOnSinglePage="true"
    [nzBordered]="true">
    <thead>
      <tr>
        <th nzAlign="center" nzWidth="75px">序号</th>
        <th nzAlign="center" nzWidth="75px">头像</th>
        <th nzAlign="center" nzWidth="150px">用户名</th>
        <th nzAlign="center" nzWidth="150px">手机号</th>
        <th nzAlign="center" nzWidth="150px">邮箱</th>
        <th nzAlign="center" nzWidth="150px">OpenId</th>
        <th nzAlign="center">操作</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of listOfData;let i = index">
        <td nzAlign="center" nzWidth="75px">{{ i + 1 + (pageIndex - 1) * pageSize }}</td>
        <td nzAlign="center" nzWidth="75px">
          <nz-avatar nzIcon="user" [nzSrc]="data.avatar | imageUri" nzSize="large"></nz-avatar>
        </td>
        <td nzAlign="center" nzWidth="150px">{{ data.userName }}</td>
        <td nzAlign="center" nzWidth="150px">{{ data.telephone }}</td>
        <td nzAlign="center" nzWidth="150px">{{ data.email }}</td>
        <td nzAlign="center" nzWidth="150px">{{ data.openId }}</td>
        <td nzAlign="center">
          <a (appThrottleClick)="viewUserDetail(data,viewContentTpl)">详细信息</a>&nbsp;&nbsp;
          <a (appThrottleClick)="editAvatar(data,avatarEdit)">设置头像</a>&nbsp;&nbsp;
          <a (appThrottleClick)="editUser(data,editContentTpl)">编辑</a>&nbsp;&nbsp;
          <a (appThrottleClick)="deleteUser(data)">删除</a>
        </td>
      </tr>
    </tbody>
  </nz-table>
</div>
<div nz-row class="mt-10">
  <nz-pagination [(nzPageIndex)]="pageIndex" [nzTotal]="total" [nzPageSize]="pageSize" [nzShowTotal]="totalTemplate"
    nzShowSizeChanger [nzPageSizeOptions]="[10,20,30,40,50]" (nzPageSizeChange)="pageSizeChange($event)"
    (nzPageIndexChange)="pageIndexChange()"></nz-pagination>
  <ng-template #totalTemplate let-total> 共计 {{ total }} 用户 </ng-template>
</div>

<!-- 用户详细信息 -->
<ng-template #viewContentTpl>
  <nz-divider nzText="认证信息"></nz-divider>

  <div nz-row class="mt-5">
    <div class="propDescribe">用户名:</div>
    <div class="propValue">{{ userDetail.userName }}</div>
  </div>
  <div nz-row class="mt-5">
    <div class="propDescribe">电子邮箱:</div>
    <div class="propValue">{{ userDetail.email }}</div>
  </div>
  <div nz-row class="mt-5">
    <div class="propDescribe">联系电话:</div>
    <div class="propValue">{{ userDetail.phoneNumber }}</div>
  </div>
  <div nz-row class="mt-5">
    <div class="propDescribe">OPENID:</div>
    <div class="propValue">{{ userDetail.openId }}</div>
  </div>

  <nz-divider nzText="基本信息"></nz-divider>
  <div nz-row class="mt-5">
    <div class="propDescribe">头像:</div>
    <div class="propValue">
      <nz-avatar nzIcon="user" [nzSrc]="userDetail.avatar | imageUri" nzSize="large"></nz-avatar>
    </div>
  </div>
  <div nz-row class="mt-5">
    <div class="propDescribe">昵称:</div>
    <div class="propValue">{{ userDetail.nickName }}</div>
  </div>
  <div nz-row class="mt-5">
    <div class="propDescribe">性别:</div>
    <div class="propValue">{{ userDetail.gender | gender }}</div>
  </div>
</ng-template>

<!--信息编辑-->
<ng-template #editContentTpl>
  <form nz-form #editForm="ngForm" (ngSubmit)="editSubmit(editForm)">
    <nz-form-item>
      <nz-form-label [nzSpan]="5">用户名</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input autocomplete="off" type="text" name="userName" #userName="ngModel"
          [(ngModel)]="editUserDetail.userName" />
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="5">电子邮箱</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input autocomplete="off" type="text" name="email" [(ngModel)]="editUserDetail.email" />
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="5">联系电话</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input autocomplete="off" type="text" name="phoneNumber" [(ngModel)]="editUserDetail.phoneNumber"
          #phoneNumber="ngModel" appTelephone />
        <nz-form-explain
          *ngIf="phoneNumber.invalid && (phoneNumber.dirty || phoneNumber.touched) && phoneNumber.errors.telephone">
          电话号码格式不正确！</nz-form-explain>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="5">OPENID</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input autocomplete="off" type="text" name="openId" [(ngModel)]="editUserDetail.openId" />
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="5">昵称</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <input nz-input autocomplete="off" type="text" name="nickName" [(ngModel)]="editUserDetail.nickName" />
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-label [nzSpan]="5">性别</nz-form-label>
      <nz-form-control [nzSpan]="12">
        <nz-select [(ngModel)]="editUserDetail.gender" name="gender">
          <nz-option *ngFor="let item of genders" [nzLabel]="item.name" [nzValue]="item.value"></nz-option>
        </nz-select>
      </nz-form-control>
    </nz-form-item>

    <nz-form-item>
      <nz-form-control [nzSpan]="12" [nzOffset]="5">
        <button class="mr-5" nz-button nzType="primary" type="submit">提交</button>
        <button class="mr-5" nz-button nzType="primary" type="button" (click)="cancelEdit()">取消</button>
      </nz-form-control>
    </nz-form-item>

  </form>
</ng-template>

<!--头像编辑-->
<ng-template #avatarEdit>
  <h2>点击修改头像</h2>
  <small>只能上传JPG格式图片，图片大小必须小于2MB，图像高宽必须一致。</small>
  <div  class="avatar-uploader" >
    <nz-upload [nzAction]="uploadUrl" nzName="avatar" nzListType="picture-card"
      [nzShowUploadList]="false" [nzBeforeUpload]="beforeUpload" (nzChange)="handleChange($event)">
      <ng-container *ngIf="!avatarUrl">
        <i class="upload-icon" nz-icon [nzType]="loading ? 'loading' : 'plus'"></i>
        <div class="ant-upload-text">Upload</div>
      </ng-container>
      <img *ngIf="avatarUrl" [src]="avatarUrl" class="avatar" />
    </nz-upload>
  </div>
  <button class="mt-5" nz-button nzType="primary" (click)="closeModal()">关闭</button>

</ng-template>